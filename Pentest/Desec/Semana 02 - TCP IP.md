# Semana 02 - TCP/IP

# Cen√°rio

Neste contexto voc√™ ainda n√£o √© um pentester mas j√° √© um profissional com conhecimentos em
seguran√ßa da informa√ß√£o.
Um dos servidores da empresa que voc√™ trabalha sofreu uma invas√£o e um acesso n√£o
autorizado foi realizado, isso teve um impacto negativo a empresa, pois o atacante quebrou a
confidencialidade da seguran√ßa da informa√ß√£o obtendo acesso a um servi√ßo do servidor.
Precisamos da sua ajuda para entender como o atacante realizou o ataque e como ele
conseguiu se autenticar no servidor. Por sorte nossa equipe conseguiu gravar toda a√ß√£o em um
arquivo pcap.

## Scan Interno

Lab ID:12af5dd169b6667369d8980e2f1189fa51817af8

**Enunciado do Lab**

Analisando o scan_interno.pcap responda:

Qual o endere√ßo f√≠sico do atacante?

[https://academy.desecsecurity.com/down/scan_interno.pcap](https://academy.desecsecurity.com/down/scan_interno.pcap)

**R- 00:0d:60:00:0c:29**

### Solu√ß√£o

Resposta foi encontrada nas informa√ß√µes da primeira conex√£o pelo Wireshark

![image.png](Asses/image.png)

---

## Scan Interno 2

Lab ID: 8a2ad0f2a6ef56041698aec8d982135f98ab95e3

**Enunciado do Lab**

Analisando o scan_interno.pcap responda:

Qual o fabricante da interface de rede usada pelo atacante?

[https://academy.desecsecurity.com/down/scan_interno.pcap](https://academy.desecsecurity.com/down/scan_interno.pcap)

**R- IBM**

### Solu√ß√£o

Jogando o endere√ßo MAC no site [Home | MAC Vendor Lookup Tool & API | MACVendors.com](https://macvendors.com/) chegamos ao resultado

![image.png](Assets/image%201.png)

---

## Scan Interno 3

Lab ID:deb291b37179821b61b4eb006e50481c6670840d

**Enunciado do Lab**

**Qual o endere√ßo l√≥gico do atacante?**

**R- 192.168.0.150**

### Solu√ß√£o

Endere√ßo logico = IP 

Ip est√° no print do Wireshark

---

## Scan Interno 4

Lab ID:b4a2826101acafe19aaa64fc55356ea88b821c8d

**Enunciado do Lab**

Qual o endere√ßo l√≥gico do alvo?

**R- 192.168.0.23**

### Solu√ß√£o

IP do alvo

---

## Portscan

Lab ID:42805ce686fb621531b71dcb6cdbd247db03012a

**Enunciado do Lab**

Quais portas estavam abertas no alvo?

**R- 80,2119,2120,2222,3306,8089**

### Solu√ß√£o

Cheguei no resultado utilizado  o comando abaixo os Cut s√£o para chegar em um resultado somente com as portas. O (grep ‚ÄúF\.‚Äù) √© que filtra pelas portas abertas pois √© uma flag de finaliza√ß√£o de conex√£o e ser finalizada a porta tem que estar aberta e ter acontecido uma conex√£o.

```bash
tcpdump -vnr scan_interno.pcap src 192.168.0.150 | cut -d "," -f1 | grep -v tos | grep -v "S" | grep "F\." | cut -d ">" -f2| cut -d "." -f5 | sort -u

```

---

## Acesso

Lab ID: e0344de4eea6e18737a84d931dcdca29913c0543

**Enunciado do Lab**

Qual a vers√£o do servi√ßo o atacante se autenticou?

**R- proftpd.1.3.5rc3**

### Solu√ß√£o

Utilizei o comando a baixo para filtrar os logs da porta 2120 adicionando o AXII (-A) e filtrando pelo codigo 220 que √© o banner que aparece a vers√£o do FTDP

```bash
tcpdump -vnAr scan_interno.pcap port 2120 | grep 220 

```

---

## Acesso II

Lab ID: b993dd431ea010bc7d04198f00a82a3ad11b5eed

**Enunciado do Lab**

Quais credenciais foram utilizadas?

**R- ftp:ftp**

### Solu√ß√£o

Utilizando a mesma logica anterior s√≥ que filtrando por USER depois por PASS

```bash
tcpdump -vnAr scan_interno.pcap port 2120 | grep USER
```

---

## Acesso III

Lab ID: 0a12f322d05b7f77ddf3d763ec9e42cd7c8f6fd1

**Enunciado do Lab**

Qual mensagem existe no servi√ßo acessado ao se conectar?

**R- DESEC_SERVER_3.0**

### Solu√ß√£o

Cheguei ao resultado investigando os logs filtrados no olho.

![image.png](Assets/image%202.png)

---

## Suporte

Lab ID: 540158c57ede89df82426756a6e81c2d268df643

**Enunciado do Lab**

**R- 72455,jdk9albert,123mudar**

### Solu√ß√£o

Realizei o filtro em todas portas e na 8089 consegui rastrear que se tratava de um suporte

```bash
Descreva aqui a solu√ß√£o do laborat√≥rio, quais dificuldades teve e como consguiu chgar √† solu√ß√£o, insira os c√≥digos em blocos separados e as mudan√ßas de exploits ou PoCs tamb√©m.
```

---

## **T√≠tulo do Lab II**

Lab ID:3adbca3d73b7104d2cc739053c8ded422aa4dfe4

**Enunciado do Lab**

Analisando a sequ√™ncia de bytes responda:

00 0c 29 76 43 e1 d4 ab 82 45 c4 0c 08 00 45 00

00 28 b5 f5 40 00 31 06 ff 0b 25 3b ae e1 c0 a8

00 0a 23 82 8f 48 00 00 00 00 04 81 18 d0 50 14

00 00 4a e6 00 00 00 00 00 00 00 00

**R- 37.59.174.225:9090**

### Solu√ß√£o

00 0c 29 76 43 e1 d4 ab 82 45 c4 0c 08 00 45 00

00 28 b5 f5 40 00 31 06 ff 0b 25 3b ae e1 c0 a8

00 0a 23 82 8f 48 00 00 00 00 04 81 18 d0 50 14

00 00 4a e6 00 00 00 00 00 00 00 00

Parte em amarela √© os dados de Ethernet, em roxo camada de rede (IPV4), em laranja camada de transporte (TCP)

**Legenda:**

- üî¥ **MAC Destino** (6 bytes)
- üîµ **MAC Origem** (6 bytes)
- üü¢ **EtherType** (2 bytes: `08 00` = IPv4)
- üü° **Cabe√ßalho IP** (Bytes iniciais e controle)
- üü£ **IP Origem** (4 bytes)
- üü† **IP Destino** (4 bytes)
- üî¥ **Porta Origem** (2 bytes)
- üîµ **Porta Destino** (2 bytes)
- ‚ö™ **Dados/Flags/Sequ√™ncia**

---

## An√°lise Bytes II

Lab ID:

**Enunciado do Lab**

Analisando a sequ√™ncia de bytes responda:

00 0c 29 76 43 e1 d4 ab 82 45 c4 0c 08 00 45 00

00 28 b5 f5 40 00 31 06 ff 0b 25 3b ae e1 c0 a8

00 0a 23 82 8f 48 00 00 00 00 04 81 18 d0 50 14

00 00 4a e6 00 00 00 00 00 00 00 00

Quais flags est√£o ativas na comunica√ß√£o?

**R- RST,ACK**

### Solu√ß√£o

Utilizando a tabela a cima sabemos que o 14¬∞ byte corresponde as flags

1 em binario √© 001 e 4 √© 0100

E utilizando a tabela a baixo chegamos a o resultado

| **Bit** | **Flag** | **Valor no seu pacote** | **Status** |
| --- | --- | --- | --- |
| 1 (C) | **CWR** (Congestion Window Reduced) | 0 | Inativa |
| 2 (E) | **ECE** (ECN-Echo) | 0 | Inativa |
| 3 (U) | **URG** (Urgent) | 0 | Inativa |
| 4 (A) | **ACK** (Acknowledgment) | **1** | **ATIVA** |
| 5 (P) | **PSH** (Push) | 0 | Inativa |
| 6 (R) | **RST** (Reset) | **1** | **ATIVA** |
| 7 (S) | **SYN** (Synchronize) | 0 | Inativa |
| 8 (F) | **FIN** (Finish) | 0 | Inativa |

---

## An√°lise Bytes 1

Lab ID:f857bca351d6814d5440068908c5bd4e7bda6054

**Enunciado do Lab

Qual socket de destino?**

**R- 37.59.174.225:80**

### Solu√ß√£o

d4 ab 82 45 c4 0c 00 0c 29 76 43 e1 08 00 45 00
02 37 2c c0 40 00 40 06 77 32 c0 a8 00 0a 25 3b
ae e1 a9 fe 00 50 ff 4d 66 60 dd cb e4 96 80 18
00 e5 96 f8 00 00 01 01 08 0a f7 cb 2f 62 41 1c
2e df 50 4f 53 54 20 2f 69 6e 74 72 61 6e 65 74
2f 68 6f 6d 65 2e 70 68 70 20 48 54 54 50 2f 31
2e 31 0d 0a 48 6f 73 74 3a 20 77 77 77 2e 62 75
73 69 6e 65 73 73 63 6f 72 70 2e 63 6f 6d 2e 62
72 0d 0a 55 73 65 72 2d 41 67 65 6e 74 3a 20 4d
6f 7a 69 6c 6c 61 2f 35 2e 30 20 28 58 31 31 3b
20 4c 69 6e 75 78 20 78 38 36 5f 36 34 3b 20 72
76 3a 36 30 2e 30 29 20 47 65 63 6b 6f 2f 32 30
L**egenda:**

- üî¥ **MAC Destino** (6 bytes)
- üîµ **MAC Origem** (6 bytes)
- üü¢ **EtherType** (2 bytes: `08 00` = IPv4)
- üü° **Cabe√ßalho IP** (Bytes iniciais e controle)
- üü£ **IP Origem** (4 bytes)
- üü† **IP Destino** (4 bytes)
- üî¥ **Porta Origem** (2 bytes)
- üîµ **Porta Destino** (2 bytes)
- ‚ö™ **Dados/Flags/Sequ√™ncia**

---

## **An√°lise Bytes 2**

Lab ID:

**Enunciado do Lab**

Qual flags est√£o ligadas?

**R- psh,ack**

### Solu√ß√£o

Utilizando a tabela do eununciado a cima sei que 18 sinaliza o hexadecimal das flags

18 em bin√°rio √© 0001 1000

E utilizando a tabela a baixo chegamos a o resultado

| **Bit** | **Flag** | **Valor no seu pacote** | **Status** |
| --- | --- | --- | --- |
| 1 (C) | **CWR** (Congestion Window Reduced) | 0 | Inativa |
| 2 (E) | **ECE** (ECN-Echo) | 0 | Inativa |
| 3 (U) | **URG** (Urgent) | 0 | Inativa |
| 4 (A) | **ACK** (Acknowledgment) | **1** | **ATIVA** |
| 5 (P) | **PSH** (Push) | 1 | ATIVA |
| 6 (R) | **RST** (Reset) |  | **Inativa** |
| 7 (S) | **SYN** (Synchronize) | 0 | Inativa |
| 8 (F) | **FIN** (Finish) | 0 | Inativa |

---

## **An√°lise Bytes 3**

Lab ID: 979b16692b51ec6185672e0a30d75ea56debf03d

**Enunciado do Lab**

Analisando a sequ√™ncia de bytes responda:

**R-** 43518

### Solu√ß√£o

Utilizando a tabela do primeiro exercicio sabemos que a porta de origem √© a9 fe 

Convertendo 43518

---

## **An√°lise Bytes 4**

Lab ID: a62a2d099c47cd6e214e9841844d97ff12d27415

**Enunciado do Lab**

Qual referer foi utilizado na requisi√ß√£o?

**R-**[http://www.businesscorp.com.br/intranet/home.php](http://www.businesscorp.com.br/intranet/home.php)

### Solu√ß√£o

Como sei onde meu pacote TCP se encerra, joguei todo o restante do codigo em um tradutor de HEX para ASCII tendo o seguinte resultado

POST /intranet/home.php HTTP/1.1
Host: [www.businesscorp.com.br](http://www.businesscorp.com.br/)
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: [http://www.businesscorp.com.br/intranet/home.php](http://www.businesscorp.com.br/intranet/home.php)
Content-Type: application/x-www-form-urlencoded
Content-Length: 38
DNT: 1
Connection: keep-alive
Upgrade-Insecure-Requests: 1

username=joinville&password=J%251345k9

---

## **An√°lise Bytes 5**

Lab ID:

**Enunciado do Lab**

Qual navegador foi utilizado?

**R-**  Firefox/60.0

### Solu√ß√£o

Resultado a cima

---

## **An√°lise Bytes 6**

Lab ID:

**Enunciado do Lab**

Qual usu√°rio e senha identificados?

**R-  joinville:J%1345k9**

### Solu√ß√£o

Na convers√£o o texto √© username=joinville&password=J%251345k9 mas como a senha usa caracter especial tive que usar a tabela do site [https://www.urlencoder.io/learn/](https://www.urlencoder.io/learn/) para me guiar

---

## **An√°lise Bytes Final**

Lab ID: fb259e940effbbd791355698b1ee778895f73e7c

**Enunciado do Lab**

Qual a key ap√≥s o acesso?

**R-  v349sl1ppw012ksks9922m**

### Solu√ß√£o

Acessei o site com o usuario e password

---

## **Invas√£o - 01**

Lab ID: 4 c48eaddcbb5b0e8df3d66e044119f7699e20089

**Enunciado do Lab**

Analise o pcap para descobrir detalhes sobre o ataque

Qual o endere√ßo f√≠sico do atacante?

https://academy.desecsecurity.com/down/invasao.pcap

**R-00:22:5a:75:34:1e**

### Solu√ß√£o

Resposta retirada do Wireshark

![image.png](Assets/image%203.png)

---

## Invas√£o - 02

Lab ID: 28ba87b9bd43f0013f88f4f53f8009eeb52e7304

**Enunciado do Lab**

Qual o fabricante do adaptador de rede do atacante?

**R- Garde Security AB**

### Solu√ß√£o

Joguei o MAC em um site de identifica√ß√£o de fabricantes

---

## Invas√£o 03

Lab ID: 28ba87b9bd43f0013f88f4f53f8009eeb52e7304

**Enunciado do Lab**

Qual o endere√ßo IP do alvo?

**R-  37.59.174.225**

### Solu√ß√£o

Valor retirado do Wireshark, foi a primeira conex√£o ap√≥s a consulta de DNS

![image.png](Assets/image%204.png)

---

## Invas√£o 04

Lab ID: 28ba87b9bd43f0013f88f4f53f8009eeb52e7304

**Enunciado do Lab**

Qual a vers√£o do servi√ßo comprometido?

**R- proftdp1.3.4a**

### Solu√ß√£o

Utilizei o comando a baixo para verificar as portas que estavam abertas e houve uma conex√£o. (80,21011)

E depois usei o comando de baixo para filtrar nos primeiros logs da porta e verificar a vers√£o no inicio da conex√£o

```bash

tcpdump -vnr invasao.pcap dst 37.59.174.225 | grep "F\." | cut -d "," -f1
tcpdump -vnAr invasao.pcap port 21011 | head -n 100

```

---

## Invas√£o 05

Lab ID: 28ba87b9bd43f0013f88f4f53f8009eeb52e7304

**Enunciado do Lab**

Quais credenciais foram utilizadas para se autenticar?

**R- jota:J0t4123**

### Solu√ß√£o

Utilizei o filtro a baixo para verificar a PASS o USER e LOGGED como momento em que foi logado para assim pegar a senha que foi utilizada

```bash
tcpdump -vnAr invasao.pcap port 21011 | grep -e PASS -e USER -e logged 

```

---

## Invas√£o 06

Lab ID: 28ba87b9bd43f0013f88f4f53f8009eeb52e7304

**Enunciado do Lab**

Qual arquivo foi roubado?

**R-  manual.pdf**

### Solu√ß√£o

Utilizei o filtro normal removendo algumas linhas e analisei os logs a m√£o

---

## Invas√£o 06

Lab ID: 28ba87b9bd43f0013f88f4f53f8009eeb52e7304

**Enunciado do Lab**

Qual arquivo foi roubado?

**R-  manual.pdf**

### Solu√ß√£o

Utilizei o filtro normal removendo algumas linhas e analisei os logs a m√£o

---